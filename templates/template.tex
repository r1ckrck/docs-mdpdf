% =============================================================================
% PDF Documentation Template
% Implements design_specification.md
% =============================================================================

\documentclass[10pt,a4paper]{article}

% =============================================================================
% PACKAGES
% =============================================================================

% Page layout
\usepackage[
  top=20mm,
  bottom=15mm,
  left=12.5mm,
  right=12.5mm,
  headheight=12pt,
  headsep=6pt,
  footskip=10pt
]{geometry}

% Fonts (requires XeLaTeX/LuaLaTeX via Tectonic)
\usepackage{fontspec}
\setmainfont{Inter}[
  UprightFont = *-Regular,
  BoldFont = *-SemiBold,
  ItalicFont = *-Italic,
  BoldItalicFont = *-SemiBoldItalic
]
\setmonofont{JetBrains Mono}[
  Scale=0.9
]

% Colors
\usepackage{xcolor}

% Primary colors
\definecolor{primary}{HTML}{181826}
\definecolor{secondary}{HTML}{ca9ee6}

% Background colors
\definecolor{pagebg}{HTML}{faf7f2}
\definecolor{codebg}{HTML}{f0ece4}
\definecolor{calloutbg}{HTML}{f4f0e8}
\definecolor{placeholderbg}{HTML}{ece8e0}

% Text colors
\definecolor{bodytext}{HTML}{181826}
\definecolor{secondarytext}{HTML}{3d3d4d}
\definecolor{tertiarytext}{HTML}{5d5d6d}

% Border/rule colors
\definecolor{tablerule}{HTML}{d4d0c6}
\definecolor{placeholderborder}{HTML}{c4c0b6}
\definecolor{accentmuted}{HTML}{a080c0}

% Callout border colors
\definecolor{noteborder}{HTML}{8d8d9d}
\definecolor{tipborder}{HTML}{ca9ee6}
\definecolor{warningborder}{HTML}{d4a574}
\definecolor{importantborder}{HTML}{a080c0}

% Syntax highlighting colors
\definecolor{synstring}{HTML}{a080c0}
\definecolor{syncomment}{HTML}{5d5d6d}
\definecolor{synnumber}{HTML}{3d3d4d}

% Page background
\usepackage{pagecolor}
\pagecolor{pagebg}

% Set default text color
\color{bodytext}

% Typography
\usepackage{setspace}
\setstretch{1.2}
\setlength{\parindent}{0pt}
\setlength{\parskip}{3pt}

% Headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\fancyhead[R]{\fontsize{8pt}{10pt}\selectfont\color{tertiarytext}$title$ | v$version$}
\fancyfoot[R]{\fontsize{8pt}{10pt}\selectfont\color{tertiarytext}\thepage}

% First page style (no header, no footer)
\fancypagestyle{firstpage}{
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

% Headings
\usepackage{titlesec}

% H1: 16pt Semibold with full-width divider
\titleformat{\section}
  {\fontsize{16pt}{19pt}\selectfont\bfseries\color{bodytext}}
  {\thesection}
  {0.5em}
  {}
  [\vspace{-6pt}\rule{\textwidth}{0.5pt}]
\titlespacing*{\section}{0pt}{14pt}{6pt}

% H2: 13pt Semibold
\titleformat{\subsection}
  {\fontsize{13pt}{16pt}\selectfont\bfseries\color{bodytext}}
  {\thesubsection}
  {0.5em}
  {}
\titlespacing*{\subsection}{0pt}{10pt}{2pt}

% H3: 11pt Medium (using bold as fallback)
\titleformat{\subsubsection}
  {\fontsize{11pt}{14pt}\selectfont\bfseries\color{bodytext}}
  {\thesubsubsection}
  {0.5em}
  {}
\titlespacing*{\subsubsection}{0pt}{8pt}{3pt}

% Orphan/widow control for headings
\widowpenalty=10000
\clubpenalty=10000
\makeatletter
\@secpenalty=-500
\makeatother

% Section numbering depth
\setcounter{secnumdepth}{3}

% Table of Contents
\usepackage{tocloft}
\renewcommand{\cfttoctitlefont}{\fontsize{13pt}{16pt}\selectfont\bfseries\color{bodytext}}
\renewcommand{\cftsecfont}{\fontsize{10pt}{12pt}\selectfont\color{bodytext}}
\renewcommand{\cftsecpagefont}{\fontsize{10pt}{12pt}\selectfont\color{secondarytext}}
\renewcommand{\cftsubsecfont}{\fontsize{10pt}{12pt}\selectfont\color{bodytext}}
\renewcommand{\cftsubsecpagefont}{\fontsize{10pt}{12pt}\selectfont\color{secondarytext}}
\renewcommand{\cftsecleader}{\hfill}
\renewcommand{\cftsubsecleader}{\hfill}
\setlength{\cftsecnumwidth}{2em}
\setlength{\cftsubsecnumwidth}{2.5em}
\setlength{\cftsubsecindent}{2em}
\setlength{\cftbeforesecskip}{6pt}
\setcounter{tocdepth}{2}

% Tables
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{colortbl}
\usepackage{calc}

% Table styling
\setlength{\tabcolsep}{8pt}
\renewcommand{\arraystretch}{1.4}
\arrayrulecolor{tablerule}
\setlength{\heavyrulewidth}{0.75pt}
\setlength{\lightrulewidth}{0.5pt}
\setlength{\cmidrulewidth}{0.5pt}

% Make tables left-aligned (override Pandoc's centering)
\setlength\LTleft{0pt}
\setlength\LTright\fill

% Reduce spacing before and after tables
\setlength\LTpre{6pt}
\setlength\LTpost{12pt}

% Table header row background (for Pandoc tables)
%\let\oldtoprule\toprule
%\let\oldmidrule\midrule
%\renewcommand{\toprule}{\oldtoprule\rowcolor{codebg}[3pt][3pt]}
%\renewcommand{\midrule}{\oldmidrule}

% Code blocks
\usepackage{listings}
\usepackage{realboxes}

\lstdefinestyle{codeblock}{
  backgroundcolor=\color{codebg},
  basicstyle=\fontsize{9pt}{12pt}\selectfont\ttfamily\color{bodytext},
  keywordstyle=\bfseries\color{bodytext},
  stringstyle=\color{synstring},
  commentstyle=\itshape\color{syncomment},
  numberstyle=\color{synnumber},
  breakatwhitespace=false,
  breaklines=true,
  keepspaces=true,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2,
  frame=none,
  xleftmargin=8pt,
  xrightmargin=8pt,
  framexleftmargin=8pt,
  framexrightmargin=8pt,
  framesep=8pt,
  aboveskip=0pt,
  belowskip=6pt
}

\lstset{style=codeblock}

% Inline code
\newcommand{\code}[1]{%
  \colorbox{codebg}{\fontsize{9pt}{11pt}\selectfont\ttfamily\color{bodytext}#1}%
}

% Override Pandoc's inline code (\texttt)
\let\oldtexttt\texttt
\renewcommand{\texttt}[1]{%
  \colorbox{codebg}{\fontsize{9pt}{11pt}\selectfont\oldtexttt{\color{bodytext}#1}}%
}

% Callouts/admonitions (using tcolorbox)
\usepackage[most]{tcolorbox}

% Base callout style
\tcbset{
  calloutbase/.style={
    enhanced,
    breakable,
    boxrule=0pt,
    frame hidden,
    borderline west={3pt}{0pt}{#1},
    colback=calloutbg,
    coltext=bodytext,
    left=10pt,
    right=10pt,
    top=10pt,
    bottom=10pt,
    before skip=10pt,
    after skip=10pt,
    fontupper=\fontsize{10pt}{14pt}\selectfont
  }
}

% Note callout
\newtcolorbox{note}{
  calloutbase=noteborder,
  before upper={\textcolor{tertiarytext}{[i]}\hspace{6pt}}
}

% Tip callout
\newtcolorbox{tip}{
  calloutbase=tipborder,
  before upper={\textcolor{tertiarytext}{*}\hspace{6pt}}
}

% Warning callout
\newtcolorbox{warning}{
  calloutbase=warningborder,
  before upper={\textcolor{tertiarytext}{[!]}\hspace{6pt}}
}

% Important callout
\newtcolorbox{important}{
  calloutbase=importantborder,
  before upper={\textcolor{tertiarytext}{[*]}\hspace{6pt}}
}

% Image placeholder
\newtcolorbox{imageplaceholder}{
  enhanced,
  breakable,
  boxrule=1pt,
  colframe=placeholderborder,
  colback=placeholderbg,
  coltext=tertiarytext,
  left=12pt,
  right=12pt,
  top=12pt,
  bottom=12pt,
  before skip=12pt,
  after skip=12pt,
  fontupper=\fontsize{9pt}{12pt}\selectfont,
  halign=center,
  valign=center,
  height=60pt,
  arc=0pt,
  borderline={1pt}{0pt}{placeholderborder, dashed}
}

% Images and figures
\usepackage{graphicx}
\usepackage{float}

% Captions
\usepackage{caption}
\captionsetup{
  font={small},
  labelfont={},
  textfont={it},
  format=plain,
  justification=justified,
  singlelinecheck=false,
  skip=6pt
}
\captionsetup[figure]{
  name=Figure,
  labelsep=colon,
  font={footnotesize,color=secondarytext},
  labelfont={footnotesize,color=secondarytext},
  textfont={footnotesize,it,color=secondarytext}
}
\captionsetup[table]{
  name=Table,
  labelsep=colon,
  font={footnotesize,color=secondarytext},
  labelfont={footnotesize,color=secondarytext},
  textfont={footnotesize,it,color=secondarytext},
  position=below,
  skip=-8pt
}

% Ensure longtables also use bottom captions
\captionsetup[longtable]{
  position=below,
  skip=-8pt
}

% Links
\usepackage{hyperref}
\hypersetup{
  colorlinks=true,
  linkcolor=secondary,
  urlcolor=secondary,
  citecolor=secondary,
  pdfborder={0 0 0}
}

% Lists
\usepackage{enumitem}
\usepackage{amssymb}  % For checkbox symbols

\setlist{
  topsep=3pt,
  itemsep=3pt,
  parsep=0pt,
  leftmargin=14pt
}

\setlist[itemize,1]{label=•}
\setlist[itemize,2]{label=◦, leftmargin=16pt}

\setlist[enumerate,1]{label=\arabic*.}
\setlist[enumerate,2]{label=\alph*., leftmargin=16pt}

% Block quotes (using tcolorbox like callouts)
\newtcolorbox{quotebox}{
  enhanced,
  breakable,
  boxrule=0pt,
  frame hidden,
  borderline west={3pt}{0pt}{tablerule},
  colback=calloutbg,
  coltext=secondarytext,
  left=10pt,
  right=10pt,
  top=10pt,
  bottom=10pt,
  before skip=10pt,
  after skip=10pt,
  fontupper=\fontsize{10pt}{14pt}\selectfont\itshape
}

% Override Pandoc's quote environment
\renewenvironment{quote}{%
  \begin{quotebox}%
}{%
  \end{quotebox}%
}

% Footnotes
\usepackage[bottom]{footmisc}
\renewcommand{\footnoterule}{%
  \kern-3pt
  {\color{tablerule}\hrule width 30mm height 0.5pt}
  \kern 2.6pt
}
\renewcommand{\thefootnote}{\textcolor{secondary}{\arabic{footnote}}}
\renewcommand{\footnotesize}{\fontsize{8pt}{10pt}\selectfont}
\setlength{\footnotesep}{8pt}

% Horizontal rule
\renewcommand{\hrulefill}{%
  \leavevmode\leaders\hbox{\rule[0.5ex]{\linewidth}{0.5pt}}\hfill\kern0pt%
}

% Pandoc-specific adjustments
\providecommand{\tightlist}{%
  \setlength{\itemsep}{4pt}\setlength{\parskip}{0pt}%
}

% Fix for Pandoc longtable without caption issue
\makeatletter
\newcounter{none}
\DeclareCaptionType{none}
\makeatother

% Pandoc code highlighting support
$if(highlighting-macros)$
$highlighting-macros$

% Redefine Shaded environment to add background color
\usepackage{framed}
\renewenvironment{Shaded}{%
  \vspace{6pt}% Reduce space before code block
  \noindent% Left-align without indentation
  \begin{minipage}{0.7\textwidth}% Max 70% width
  \def\FrameCommand{\fboxsep=12pt\colorbox{codebg}}% Increase left/right padding
  \MakeFramed{\advance\hsize-\width\FrameRestore}%
  \fontsize{9pt}{12pt}\selectfont\ttfamily%
}{%
  \endMakeFramed%
  \end{minipage}%
  \vspace{6pt}% Reduce space after code block
}
$endif$

% CSL references
$if(csl-refs)$
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newenvironment{CSLReferences}[2]{}{}
$endif$

% =============================================================================
% DOCUMENT
% =============================================================================

\begin{document}

% First page: Cover + TOC
\thispagestyle{firstpage}

% Title block
{\fontsize{16pt}{19pt}\selectfont\bfseries $title$\par}
\vspace{4pt}
{\fontsize{9pt}{11pt}\selectfont\color{secondarytext}%
$if(author)$$author$ · $endif$v$version$$if(date)$ · $date$$endif$\par}

\vspace{18pt}

% Table of contents
\tableofcontents
\thispagestyle{firstpage}

\newpage

% Content
$body$

\end{document}
